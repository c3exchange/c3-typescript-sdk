import { LogicSigAccount } from "algosdk"
import { UserAddress } from "../interfaces"
import { IPackedInfo, packData } from "../utils"

export const proxyDataFormat: IPackedInfo = {
    server: { type: 'address' },
}

export const compiledProxyFormat: IPackedInfo = {
    chunk0: { type: 'fixed', valueHex: '0820070001024A484D6F260100312032031244310932031244311532031244311081061244310122124431052812442238102312448020' },
    data: { type: 'object', info: proxyDataFormat },
    chunk1: { type: 'fixed', valueHex: '35003400350322380034031244361A0280076465706F7369741240001B361A013501361A02350231192212443401361A0334028800FE23433119221231192312114423438A02002847042228498BFF5700488C078B078C018B0115165706008B01508C018BFF8BFF2104598BFF2559528C028BFF8BFF25598BFF210559528C068BFF8BFF2106594B0115528C038BFF8BFF2105598BFF210659528C048BFF814C558C058B035702008B06570200508C008B0015165706008B00508C0080082843332E494F29308B01570200508B02570200508B065702005E0112448B0522124000438B052312400001008B00570200028B0457020057400117811B098B045702005700208B045702005720200700350635058BFE570C14340534065002570C14124442000E8B005702008B045702008BFE8444898A03002849222847072247022849228BFE8C058BFD8C008B00158120124422350434048B0522598C0C8B0C0C41008A8B058B052434040B2408592408340423088B0522598C0D8B0D124000678B052434040B24082408592408528C078B07574F208C018B008B0112448B008B0788FEA08B078B072104598B072559528C088B085702008C098B095701208C008B0922558C028B02810312448B0981295B8C0B8B0B22128B0B31030F114434042308350442FF6E8B051542FFA08BFF574F208C018B008B0112448B018BFF88FE438BFF5700488C0A8B0A5700208C0E8B0E8BFD12448B0A5720208C0F8B0A81405B8C108B0F3106128B1031040F108B102212114489' },
}

export type SignatureValidator = {
    address: UserAddress,
    logicSig: LogicSigAccount
}

export function makeSignatureValidator(
    // TODO: This will always be an Algorand Address, we need a new type to specify Algorand Addresses
    address: UserAddress
): SignatureValidator {
    const data = {
        data: {
            server: address,
        },
    }
    const bytecode = packData(data, compiledProxyFormat, false)
    return {
        address,
        logicSig: new LogicSigAccount(bytecode)
    }
}